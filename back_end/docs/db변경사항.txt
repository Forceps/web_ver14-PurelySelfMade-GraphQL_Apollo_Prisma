CREATE SCHEMA `square_post` ;

CREATE TABLE `square_post`.`user` (
  `user_id` int unsigned NOT NULL AUTO_INCREMENT,
  `username` varchar(60) NOT NULL,
  `email` varchar(150) NOT NULL,
  `password` varchar(45) NOT NULL,
  `avatar` mediumtext,
  `back_img` mediumtext,
  `phone_number` int unsigned DEFAULT NULL,
  PRIMARY KEY (`user_id`),
  UNIQUE KEY `user_id_UNIQUE` (`user_id`),
  UNIQUE KEY `email_UNIQUE` (`email`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `square_post`.`group_system` (
  `group_system_id` tinyint unsigned NOT NULL AUTO_INCREMENT,
  `category` varchar(30) NOT NULL,
  `name` varchar(60) NOT NULL,
  PRIMARY KEY (`group_system_id`),
  UNIQUE KEY `groupSystem_id_UNIQUE` (`group_system_id`)
) ENGINE=InnoDB AUTO_INCREMENT=14 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `square_post`.`group` (
  `group_id` int unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(100) NOT NULL,
  `purpose` varchar(200) NOT NULL,
  `administrator` int unsigned NOT NULL,
  `identiti_profile_img` mediumtext,
  `identiti_back_img` mediumtext,
  `participation_system` tinyint unsigned NOT NULL,
  `withdrawal_system` tinyint unsigned NOT NULL,
  PRIMARY KEY (`group_id`),
  UNIQUE KEY `group_id_UNIQUE` (`group_id`),
  UNIQUE KEY `purpose_UNIQUE` (`purpose`),
  KEY `who_is_admin_idx` (`administrator`),
  KEY `participation_idx` (`participation_system`),
  KEY `withdrawal_idx` (`withdrawal_system`),
  FULLTEXT KEY `their_purpose` (`purpose`),
  CONSTRAINT `participation` FOREIGN KEY (`participation_system`) REFERENCES `group_system` (`group_system_id`),
  CONSTRAINT `who_is_admin` FOREIGN KEY (`administrator`) REFERENCES `user` (`user_id`),
  CONSTRAINT `withdrawal` FOREIGN KEY (`withdrawal_system`) REFERENCES `group_system` (`group_system_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `square_post`.`post` (
  `post_id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `user` int unsigned NOT NULL,
  `caption` varchar(45) NOT NULL,
  `content` longtext,
  `directory` bigint unsigned NOT NULL,
  `views` bigint unsigned NOT NULL DEFAULT '0',
  `likes` bigint unsigned NOT NULL DEFAULT '0',
  `year` smallint unsigned NOT NULL,
  `month` tinyint unsigned NOT NULL,
  `day` tinyint unsigned NOT NULL,
  `hour` tinyint unsigned NOT NULL,
  `minute` tinyint unsigned NOT NULL,
  `second` tinyint unsigned NOT NULL,
  PRIMARY KEY (`post_id`),
  UNIQUE KEY `post_id_UNIQUE` (`post_id`),
  KEY `user_idx` (`user`),
  KEY `belong_idx` (`directory`),
  FULLTEXT KEY `search_post` (`caption`,`content`),
  CONSTRAINT `author` FOREIGN KEY (`user`) REFERENCES `user` (`user_id`) ON DELETE CASCADE,
  CONSTRAINT `belong` FOREIGN KEY (`directory`) REFERENCES `directory` (`directory_id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO square_post.group_system (name, category) VALUES ('Application_NoRequireApproval', 'participation');
INSERT INTO square_post.group_system (name, category) VALUES ('Recommendation_Anyone', 'participation');
INSERT INTO square_post.group_system (name, category) VALUES ('Recommendation_OnlyAdministrator', 'participation');
INSERT INTO square_post.group_system (name, category) VALUES ('Recommendation_SomePeople', 'participation');
INSERT INTO square_post.group_system (name, category) VALUES ('Application_RequireApproval_OnlyAdministrator', 'participation');
INSERT INTO square_post.group_system (name, category) VALUES ('Application_RequireApproval_SomePeople', 'participation');
INSERT INTO square_post.group_system (name, category) VALUES ('Application_RequireApproval_Voting', 'participation');
INSERT INTO square_post.group_system (name, category) VALUES ('Application_RequireApproval_Unanimity', 'participation');
INSERT INTO square_post.group_system (name, category) VALUES ('Spontaneous', 'withdrawal');
INSERT INTO square_post.group_system (name, category) VALUES ('ExitOrder_OnlyAdministrator', 'withdrawal');
INSERT INTO square_post.group_system (name, category) VALUES ('ExitOrder_SomePeople', 'withdrawal');
INSERT INTO square_post.group_system (name, category) VALUES ('ExitOrder_Voting', 'withdrawal');
INSERT INTO square_post.group_system (name, category) VALUES ('ExitOrder_Unanimity', 'withdrawal');

CREATE TABLE `square_post`.`watched` (
  `watched_id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `user` int unsigned NOT NULL,
  `post` bigint unsigned NOT NULL,
  `count` tinyint unsigned NOT NULL DEFAULT '1',
  `interest` tinyint unsigned NOT NULL DEFAULT '5',
  PRIMARY KEY (`watched_id`),
  UNIQUE KEY `watched_id_UNIQUE` (`watched_id`),
  KEY `watching_user_idx` (`user`),
  KEY `watched_post_idx` (`post`),
  CONSTRAINT `watched_post` FOREIGN KEY (`post`) REFERENCES `post` (`post_id`) ON DELETE CASCADE,
  CONSTRAINT `watching_user` FOREIGN KEY (`user`) REFERENCES `user` (`user_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `square_post`.`video` (
  `video_id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `address` mediumtext NOT NULL,
  `caption` varchar(60) NOT NULL,
  `directory` bigint unsigned NOT NULL,
  `volume` int unsigned NOT NULL,
  `type` varchar(15) DEFAULT NULL,
  `thumbnail` mediumtext,
  PRIMARY KEY (`video_id`),
  UNIQUE KEY `video_id_UNIQUE` (`video_id`),
  KEY `video_dir_idx` (`directory`),
  CONSTRAINT `video_dir` FOREIGN KEY (`directory`) REFERENCES `directory` (`directory_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `square_post`.`user_relevance` (
  `user_relevance_id` bigint unsigned NOT NULL,
  `user1` int unsigned NOT NULL,
  `user2` int unsigned NOT NULL,
  `degree` smallint unsigned NOT NULL,
  PRIMARY KEY (`user_relevance_id`),
  KEY `user1_idx` (`user1`),
  KEY `user2_idx` (`user2`),
  CONSTRAINT `user1` FOREIGN KEY (`user1`) REFERENCES `user` (`user_id`) ON DELETE CASCADE,
  CONSTRAINT `user2` FOREIGN KEY (`user2`) REFERENCES `user` (`user_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `square_post`.`subscriber` (
  `subscriber_id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `author` int unsigned NOT NULL,
  `reader` int unsigned NOT NULL,
  PRIMARY KEY (`subscriber_id`),
  UNIQUE KEY `subscriber_id_UNIQUE` (`subscriber_id`),
  KEY `publisher_idx` (`author`),
  KEY `reader_idx` (`reader`),
  KEY `arrive_at_idx` (`reader`),
  KEY `distributer_idx` (`author`),
  CONSTRAINT `arrive_at` FOREIGN KEY (`reader`) REFERENCES `user` (`user_id`) ON DELETE CASCADE,
  CONSTRAINT `distributer` FOREIGN KEY (`author`) REFERENCES `user` (`user_id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `square_post`.`post_relevance` (
  `post_relevance_id` bigint unsigned NOT NULL,
  `post1` bigint unsigned NOT NULL,
  `post2` bigint unsigned NOT NULL,
  `degree` smallint unsigned NOT NULL,
  PRIMARY KEY (`post_relevance_id`),
  UNIQUE KEY `post_relevance_id_UNIQUE` (`post_relevance_id`),
  KEY `post1_idx` (`post1`),
  KEY `post2_idx` (`post2`),
  CONSTRAINT `post1` FOREIGN KEY (`post1`) REFERENCES `post` (`post_id`) ON DELETE CASCADE,
  CONSTRAINT `post2` FOREIGN KEY (`post2`) REFERENCES `post` (`post_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `square_post`.`notification` (
  `notification_id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `title` varchar(120) NOT NULL,
  `content` longtext NOT NULL,
  `user` int unsigned NOT NULL,
  `sender` varchar(60) NOT NULL DEFAULT 'Administrator',
  `year` mediumint unsigned NOT NULL,
  `month` tinyint unsigned NOT NULL,
  `day` tinyint unsigned NOT NULL,
  `hour` tinyint unsigned NOT NULL,
  `minute` tinyint unsigned NOT NULL,
  `second` tinyint unsigned NOT NULL,
  PRIMARY KEY (`notification_id`),
  UNIQUE KEY `notification_id_UNIQUE` (`notification_id`),
  KEY `to_who_idx` (`user`),
  CONSTRAINT `to_who` FOREIGN KEY (`user`) REFERENCES `user` (`user_id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=16 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `square_post`.`music` (
  `music_id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `address` mediumtext NOT NULL,
  `caption` varchar(60) NOT NULL,
  `directory` bigint unsigned NOT NULL,
  `volume` int unsigned NOT NULL,
  `type` varchar(15) DEFAULT NULL,
  PRIMARY KEY (`music_id`),
  UNIQUE KEY `music_id_UNIQUE` (`music_id`),
  KEY `music_dir_idx` (`directory`),
  CONSTRAINT `music_dir` FOREIGN KEY (`directory`) REFERENCES `directory` (`directory_id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=14 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `square_post`.`liked` (
  `liked_id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `user` int unsigned NOT NULL,
  `post` bigint unsigned NOT NULL,
  PRIMARY KEY (`liked_id`),
  UNIQUE KEY `liked_id_UNIQUE` (`liked_id`),
  KEY `liking_user_idx` (`user`),
  KEY `liked_post_idx` (`post`),
  CONSTRAINT `liked_post` FOREIGN KEY (`post`) REFERENCES `post` (`post_id`) ON DELETE CASCADE,
  CONSTRAINT `liking_user` FOREIGN KEY (`user`) REFERENCES `user` (`user_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `square_post`.`image` (
  `image_id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `address` mediumtext NOT NULL,
  `caption` varchar(60) NOT NULL,
  `directory` bigint unsigned NOT NULL,
  `volume` int unsigned NOT NULL,
  `type` varchar(15) DEFAULT NULL,
  PRIMARY KEY (`image_id`),
  UNIQUE KEY `image_id_UNIQUE` (`image_id`),
  KEY `image_dir_idx` (`directory`),
  CONSTRAINT `image_dir` FOREIGN KEY (`directory`) REFERENCES `directory` (`directory_id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `square_post`.`friend` (
  `friend_id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `proposer` int unsigned NOT NULL,
  `respondent` int unsigned NOT NULL,
  `consent` tinyint(1) NOT NULL DEFAULT '0',
  PRIMARY KEY (`friend_id`),
  UNIQUE KEY `friend_id_UNIQUE` (`friend_id`),
  KEY `respondent_idx` (`respondent`),
  KEY `proposer_idx` (`proposer`),
  CONSTRAINT `proposer` FOREIGN KEY (`proposer`) REFERENCES `user` (`user_id`) ON DELETE CASCADE,
  CONSTRAINT `respondent` FOREIGN KEY (`respondent`) REFERENCES `user` (`user_id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `square_post`.`comment` (
  `comment_id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `post` bigint unsigned NOT NULL,
  `user` int unsigned NOT NULL,
  `comment` varchar(300) NOT NULL,
  `likes` int NOT NULL DEFAULT '0',
  `year` smallint NOT NULL,
  `month` tinyint NOT NULL,
  `day` tinyint NOT NULL,
  `hour` tinyint NOT NULL,
  `minute` tinyint NOT NULL,
  `converted` tinyint(1) NOT NULL DEFAULT '0',
  PRIMARY KEY (`comment_id`),
  UNIQUE KEY `comment_id_UNIQUE` (`comment_id`),
  KEY `who_user_idx` (`user`),
  KEY `what_post_idx` (`post`),
  CONSTRAINT `what_post` FOREIGN KEY (`post`) REFERENCES `post` (`post_id`) ON DELETE CASCADE,
  CONSTRAINT `who_user` FOREIGN KEY (`user`) REFERENCES `user` (`user_id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `square_post`.`chat_room` (
  `chat_room_id` int unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(45) NOT NULL,
  PRIMARY KEY (`chat_room_id`),
  UNIQUE KEY `room_id_UNIQUE` (`chat_room_id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `square_post`.`chat_member` (
  `chat_member_id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `user` int unsigned NOT NULL,
  `room` int unsigned NOT NULL,
  PRIMARY KEY (`chat_member_id`),
  UNIQUE KEY `chat_member_id_UNIQUE` (`chat_member_id`),
  KEY `member_idx` (`user`),
  KEY `room_idx` (`room`),
  CONSTRAINT `member` FOREIGN KEY (`user`) REFERENCES `user` (`user_id`) ON DELETE CASCADE,
  CONSTRAINT `room` FOREIGN KEY (`room`) REFERENCES `chat_room` (`chat_room_id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `square_post`.`chat` (
  `chat_id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `user` int unsigned NOT NULL,
  `room` int unsigned NOT NULL,
  `comment` varchar(300) NOT NULL,
  `year` smallint NOT NULL,
  `month` tinyint NOT NULL,
  `day` tinyint NOT NULL,
  `hour` tinyint NOT NULL,
  `minute` tinyint NOT NULL,
  `second` tinyint NOT NULL,
  PRIMARY KEY (`chat_id`),
  UNIQUE KEY `chat_member_id_UNIQUE` (`chat_id`),
  KEY `Participant_idx` (`user`),
  KEY `Affiliation_idx` (`room`),
  CONSTRAINT `chatter` FOREIGN KEY (`user`) REFERENCES `user` (`user_id`) ON DELETE CASCADE,
  CONSTRAINT `where_is_the_room` FOREIGN KEY (`room`) REFERENCES `chat_room` (`chat_room_id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
